services:
  app:    
    extends:
      file: ./compose.yml
      service: app    
    build:
      context: ..
      target: e2e
    image: ratewise:e2e
    ports:
      - ${SERVER_PORT:-3001}:3000
    env_file:
      - path: ../.env.defaults
        required: true 
      - path: ../.env.e2e
        required: false       

  migrate:    
    extends:
      file: ./compose.yml
      service: migrate

  postgres:        
    extends: 
      file: ./compose.yml
      service: postgres 
    tmpfs: /var/lib/postgresql/data      

  redis:            
    extends: 
      file: ./compose.yml
      service: redis
    command: redis-server --appendonly no --save ""    
    tmpfs: /data

  mailpit:        
    extends: 
      file: ./compose.yml
      service: mailpit    
    # volumes:
    #     - mailpit:/data    